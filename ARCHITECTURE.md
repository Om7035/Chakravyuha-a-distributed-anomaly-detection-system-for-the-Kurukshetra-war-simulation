# Architecture Diagram 🏗️

## System Overview

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      PROJECT CHAKRAVYUHA                                │
│              Real-Time Anomaly Detection System                         │
└─────────────────────────────────────────────────────────────────────────┘
```

## Complete Data Flow

```
┌──────────────────────────────────────────────────────────────────────────┐
│  STEP 1: SIMULATION                                                      │
│  ┌────────────────────────────────────────────────────────────┐         │
│  │  SimPy Environment                                          │         │
│  │  ┌────┐ ┌────┐ ┌────┐           ┌────┐                    │         │
│  │  │ S1 │ │ S2 │ │ S3 │    ...    │S100│  (100 Soldiers)    │         │
│  │  └─┬──┘ └─┬──┘ └─┬──┘           └─┬──┘                    │         │
│  │    │      │      │                 │                       │         │
│  │    └──────┴──────┴─────────────────┘                       │         │
│  │                   │                                         │         │
│  │         Every 1 second, each soldier:                      │         │
│  │         • Updates heart_rate (60-100 normal)               │         │
│  │         • Updates stamina (0-100)                          │         │
│  │         • 5% chance of "poison" (HR → 180-200)             │         │
│  └────────────────────────┬───────────────────────────────────┘         │
└───────────────────────────┼──────────────────────────────────────────────┘
                            │
                            ↓ JSON Events
                            
┌──────────────────────────────────────────────────────────────────────────┐
│  STEP 2: MESSAGE QUEUE                                                   │
│  ┌────────────────────────────────────────────────────────────┐         │
│  │  Apache Kafka / Redpanda                                    │         │
│  │  Topic: "soldier_telemetry"                                 │         │
│  │                                                              │         │
│  │  ┌──────────────────────────────────────────────┐          │         │
│  │  │ {"soldier_id": 42,                            │          │         │
│  │  │  "timestamp": 1732456789.123,                 │          │         │
│  │  │  "heart_rate": 185,  ← ANOMALY!               │          │         │
│  │  │  "stamina": 100}                              │          │         │
│  │  └──────────────────────────────────────────────┘          │         │
│  │                                                              │         │
│  │  Port: 31092 (NodePort)                                     │         │
│  └────────────────────────┬───────────────────────────────────┘         │
└───────────────────────────┼──────────────────────────────────────────────┘
                            │
                            ↓ Stream Processing
                            
┌──────────────────────────────────────────────────────────────────────────┐
│  STEP 3: FEATURE STORE                                                   │
│  ┌────────────────────────────────────────────────────────────┐         │
│  │  Feast Feature Store                                        │         │
│  │                                                              │         │
│  │  ┌─────────────────┐         ┌─────────────────┐          │         │
│  │  │  ONLINE STORE   │         │  OFFLINE STORE  │          │         │
│  │  │                 │         │                 │          │         │
│  │  │  Redis          │         │  Parquet Files  │          │         │
│  │  │  (Port 6379)    │         │  (Local Disk)   │          │         │
│  │  │                 │         │                 │          │         │
│  │  │  Recent data    │         │  Historical     │          │         │
│  │  │  (last 1 hour)  │         │  data (months)  │          │         │
│  │  └─────────────────┘         └─────────────────┘          │         │
│  │                                                              │         │
│  │  Features Computed:                                         │         │
│  │  • avg_heart_rate_5min                                      │         │
│  │  • max_heart_rate_1min                                      │         │
│  │  • stamina_trend                                            │         │
│  └────────────────────────┬───────────────────────────────────┘         │
└───────────────────────────┼──────────────────────────────────────────────┘
                            │
                            ↓ Features
                            
┌──────────────────────────────────────────────────────────────────────────┐
│  STEP 4: ML MODEL                                                        │
│  ┌────────────────────────────────────────────────────────────┐         │
│  │  Temporal Fusion Transformer (TFT)                          │         │
│  │                                                              │         │
│  │  ┌──────────────────────────────────────────────┐          │         │
│  │  │  INPUT: Time-series features                 │          │         │
│  │  │  [HR_t-30, HR_t-29, ..., HR_t-1, HR_t]      │          │         │
│  │  └──────────────┬───────────────────────────────┘          │         │
│  │                 │                                            │         │
│  │                 ↓                                            │         │
│  │  ┌──────────────────────────────────────────────┐          │         │
│  │  │  ENCODER: LSTM + Attention                    │          │         │
│  │  │  Learns temporal patterns                     │          │         │
│  │  └──────────────┬───────────────────────────────┘          │         │
│  │                 │                                            │         │
│  │                 ↓                                            │         │
│  │  ┌──────────────────────────────────────────────┐          │         │
│  │  │  DECODER: Multi-head Attention                │          │         │
│  │  │  Predicts future values                       │          │         │
│  │  └──────────────┬───────────────────────────────┘          │         │
│  │                 │                                            │         │
│  │                 ↓                                            │         │
│  │  ┌──────────────────────────────────────────────┐          │         │
│  │  │  OUTPUT: Predicted HR = 72 ± 5                │          │         │
│  │  │  Actual HR = 185                              │          │         │
│  │  │  Difference = 113 → ANOMALY!                  │          │         │
│  │  └──────────────────────────────────────────────┘          │         │
│  │                                                              │         │
│  │  Framework: PyTorch Lightning                               │         │
│  │  Training: Offline on historical data                       │         │
│  └────────────────────────┬───────────────────────────────────┘         │
└───────────────────────────┼──────────────────────────────────────────────┘
                            │
                            ↓ Predictions
                            
┌──────────────────────────────────────────────────────────────────────────┐
│  STEP 5: ANOMALY DETECTION                                               │
│  ┌────────────────────────────────────────────────────────────┐         │
│  │  Detection Logic                                            │         │
│  │                                                              │         │
│  │  IF heart_rate > 170:                                       │         │
│  │      anomaly_score = 0.95                                   │         │
│  │      status = "BREACH"                                      │         │
│  │      alert_type = "POISON"                                  │         │
│  │                                                              │         │
│  │  ELIF stamina < 20 AND heart_rate > 100:                   │         │
│  │      anomaly_score = 0.80                                   │         │
│  │      status = "BREACH"                                      │         │
│  │      alert_type = "FATIGUE"                                 │         │
│  │                                                              │         │
│  │  ELSE:                                                       │         │
│  │      anomaly_score = 0.05                                   │         │
│  │      status = "SECURE"                                      │         │
│  └────────────────────────┬───────────────────────────────────┘         │
└───────────────────────────┼──────────────────────────────────────────────┘
                            │
                            ↓ Results
                            
┌──────────────────────────────────────────────────────────────────────────┐
│  STEP 6: API SERVING                                                     │
│  ┌────────────────────────────────────────────────────────────┐         │
│  │  FastAPI REST API                                           │         │
│  │                                                              │         │
│  │  POST /predict                                              │         │
│  │  ┌──────────────────────────────────────────────┐          │         │
│  │  │ Request:                                      │          │         │
│  │  │ {                                             │          │         │
│  │  │   "soldier_id": 42,                           │          │         │
│  │  │   "heart_rate": 185,                          │          │         │
│  │  │   "stamina": 100,                             │          │         │
│  │  │   "timestamp": 1732456789.123                 │          │         │
│  │  │ }                                             │          │         │
│  │  └──────────────────────────────────────────────┘          │         │
│  │                 │                                            │         │
│  │                 ↓                                            │         │
│  │  ┌──────────────────────────────────────────────┐          │         │
│  │  │ Response:                                     │          │         │
│  │  │ {                                             │          │         │
│  │  │   "soldier_id": 42,                           │          │         │
│  │  │   "anomaly_score": 0.95,                      │          │         │
│  │  │   "is_anomalous": true,                       │          │         │
│  │  │   "status": "BREACH"                          │          │         │
│  │  │ }                                             │          │         │
│  │  └──────────────────────────────────────────────┘          │         │
│  │                                                              │         │
│  │  Port: 8000                                                 │         │
│  │  Docs: http://localhost:8000/docs                          │         │
│  └────────────────────────────────────────────────────────────┘         │
└──────────────────────────────────────────────────────────────────────────┘
```

## Infrastructure Layer

```
┌──────────────────────────────────────────────────────────────────────────┐
│  KUBERNETES CLUSTER (Minikube)                                           │
│  ┌────────────────────────────────────────────────────────────┐         │
│  │  Namespace: kafka                                           │         │
│  │  ┌──────────────────────────────────────────────┐          │         │
│  │  │  Pod: kafka-controller-0                      │          │         │
│  │  │  Image: bitnami/kafka:3.6                     │          │         │
│  │  │  Resources: 512Mi RAM, 0.5 CPU                │          │         │
│  │  │  Service: NodePort 31092                      │          │         │
│  │  └──────────────────────────────────────────────┘          │         │
│  └────────────────────────────────────────────────────────────┘         │
│                                                                           │
│  ┌────────────────────────────────────────────────────────────┐         │
│  │  Namespace: feast                                           │         │
│  │  ┌──────────────────────────────────────────────┐          │         │
│  │  │  Pod: redis-master-0                          │          │         │
│  │  │  Image: bitnami/redis:7.0                     │          │         │
│  │  │  Resources: 256Mi RAM                         │          │         │
│  │  │  Service: ClusterIP 6379                      │          │         │
│  │  │  Status: RUNNING ✅                            │          │         │
│  │  └──────────────────────────────────────────────┘          │         │
│  └────────────────────────────────────────────────────────────┘         │
│                                                                           │
│  ┌────────────────────────────────────────────────────────────┐         │
│  │  Namespace: minio                                           │         │
│  │  ┌──────────────────────────────────────────────┐          │         │
│  │  │  Pod: minio-xxx                               │          │         │
│  │  │  Image: minio/minio:latest                    │          │         │
│  │  │  Resources: 256Mi RAM                         │          │         │
│  │  │  Service: ClusterIP 9000                      │          │         │
│  │  │  Purpose: S3-compatible object storage        │          │         │
│  │  └──────────────────────────────────────────────┘          │         │
│  └────────────────────────────────────────────────────────────┘         │
│                                                                           │
│  Total Resources: 3.5GB RAM, 2 CPUs                                      │
│  Driver: Docker                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

## Technology Stack Layers

```
┌──────────────────────────────────────────────────────────────────────────┐
│  APPLICATION LAYER                                                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                     │
│  │  Simulation │  │  Training   │  │   Serving   │                     │
│  │   (SimPy)   │  │  (PyTorch)  │  │  (FastAPI)  │                     │
│  └─────────────┘  └─────────────┘  └─────────────┘                     │
└──────────────────────────────────────────────────────────────────────────┘
                            ↓
┌──────────────────────────────────────────────────────────────────────────┐
│  DATA LAYER                                                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                     │
│  │    Kafka    │  │    Redis    │  │    MinIO    │                     │
│  │  (Stream)   │  │  (Cache)    │  │  (Storage)  │                     │
│  └─────────────┘  └─────────────┘  └─────────────┘                     │
└──────────────────────────────────────────────────────────────────────────┘
                            ↓
┌──────────────────────────────────────────────────────────────────────────┐
│  ORCHESTRATION LAYER                                                     │
│  ┌─────────────────────────────────────────────────────────┐            │
│  │  Kubernetes (Minikube)                                   │            │
│  │  • Pod Management                                        │            │
│  │  • Service Discovery                                     │            │
│  │  • Resource Allocation                                   │            │
│  └─────────────────────────────────────────────────────────┘            │
└──────────────────────────────────────────────────────────────────────────┘
                            ↓
┌──────────────────────────────────────────────────────────────────────────┐
│  INFRASTRUCTURE LAYER                                                    │
│  ┌─────────────────────────────────────────────────────────┐            │
│  │  Docker Desktop                                          │            │
│  │  • Container Runtime                                     │            │
│  │  • Image Management                                      │            │
│  │  • Networking                                            │            │
│  └─────────────────────────────────────────────────────────┘            │
└──────────────────────────────────────────────────────────────────────────┘
                            ↓
┌──────────────────────────────────────────────────────────────────────────┐
│  HARDWARE LAYER                                                          │
│  ┌─────────────────────────────────────────────────────────┐            │
│  │  Your Laptop                                             │            │
│  │  • 8GB RAM (3.5GB allocated to Minikube)                │            │
│  │  • 2 CPU Cores                                           │            │
│  │  • Windows 11                                            │            │
│  └─────────────────────────────────────────────────────────┘            │
└──────────────────────────────────────────────────────────────────────────┘
```

## Deployment Workflow

```
Developer Machine                    Minikube Cluster
─────────────────                    ────────────────

┌─────────────┐
│  Write Code │
└──────┬──────┘
       │
       ↓
┌─────────────┐
│ Terraform   │
│   Plan      │
└──────┬──────┘
       │
       ↓
┌─────────────┐                     ┌─────────────┐
│ Terraform   │ ─────────────────→  │   Create    │
│   Apply     │                     │  Resources  │
└─────────────┘                     └──────┬──────┘
                                           │
                                           ↓
                                    ┌─────────────┐
                                    │ Helm Charts │
                                    │   Deploy    │
                                    └──────┬──────┘
                                           │
                                           ↓
                                    ┌─────────────┐
                                    │    Pods     │
                                    │   Running   │
                                    └──────┬──────┘
                                           │
       ┌───────────────────────────────────┘
       │
       ↓
┌─────────────┐
│ Port Forward│
│  Services   │
└──────┬──────┘
       │
       ↓
┌─────────────┐
│  Run App    │
│  Locally    │
└─────────────┘
```

---

**Legend:**
- `┌─┐` = Component/Service
- `→` = Data Flow
- `↓` = Process Flow
- `✅` = Running/Active
